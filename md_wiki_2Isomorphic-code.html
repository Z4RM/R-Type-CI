<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>R-Type: Isomorphic code</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">R-Type
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_wiki_2Isomorphic-code.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Isomorphic code</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md85"></a></p>
<h1><a class="anchor" id="autotoc_md86"></a>
Overview</h1>
<p>Isomorphic (or universal) code is code that runs on both the server and on the client. This avoids writing the same code twice, for each part.</p>
<h1><a class="anchor" id="autotoc_md87"></a>
Implementation</h1>
<p>All the code of the <b>R-Type</b> application is contained in the <code>src/</code> directory. No matter if you run the server or the client<sup>1</sup>, the same entrypoint will be used and the same code will be executed.</p>
<p><sup>1</sup> Within the <b>R-Type</b>, the server and the client are two different executables: <code>r-type_server</code> for the server, and <code>r-type_client</code> for the client.</p>
<h1><a class="anchor" id="autotoc_md88"></a>
Differentiate the server from the client (and vice versa)</h1>
<p>Having the same code for the server and the client is nice, but some parts of the code may not to have run on both (e.g., server doesn't need to perform rendering actions, or client doesn't need to communicate with the other players).</p>
<p>To remedy it, different macros are defined on the server and on the client:</p><ul>
<li>On the server, a <code>RTYPE_IS_SERVER</code> macro is defined.</li>
<li>On the client, a <code>RTYPE_IS_CLIENT</code> macro is defined.\ They permit to conditonnaly exclude code at the compilation, using <a href="https://cplusplus.com/doc/tutorial/preprocessor/">preprocessor directives</a>. For example, to write code that will be only executed (and compiled) on the client, you can do this: <div class="fragment"><div class="line"><span class="keywordtype">void</span> foo() {</div>
<div class="line"><span class="preprocessor">#ifdef RTYPE_IS_CLIENT</span></div>
<div class="line">    <span class="comment">// Client-only code</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ul>
<hr  />
<dl class="section warning"><dt>Warning</dt><dd>Using this directive will completely remove the code contained in it from the compiled binary. It's so impossible to enable the code after the compilation.\ However, the client can also be a server: if a player wants to host himself a game to play with his friends, it's possible. To do this, he should be able to "enable" the server on it's client - which is impossible using preprocessor directives and <code>#ifdef RTYPE_IS_SERVER</code>.\ To remedy it, a special class was created: a mode manager.</dd></dl>
<h1><a class="anchor" id="autotoc_md90"></a>
Mode manager</h1>
<p>The mode manager is a simple utility class (<code><a class="el" href="classrtype_1_1ModeManager.html" title="Manages the program mode (server, client, client with server). It allows to get the current state of ...">rtype::ModeManager</a></code>) which permits to know the current state of the server part (enabled or disabled).</p>
<p>Depending on if the class is compiled with the server or the client, it will not have the same behaviour (using previously introduced preprocessor directives).</p><ul>
<li>If it's defined on the server, the class only defines one method, <code>isServer</code> (<code><a class="el" href="classrtype_1_1ModeManager.html#a5db557e9519ac166c01dad0f9f640749">rtype::ModeManager::isServer</a></code>). It always returns <code>true</code> (since the server is server, and cannot disable itself).</li>
<li>If it's defined on the client:<ul>
<li>The same method (<code><a class="el" href="classrtype_1_1ModeManager.html#a5db557e9519ac166c01dad0f9f640749">rtype::ModeManager::isServer</a></code>) as the one on the server is defined. However, it returns either <code>false</code> or <code>true</code>, depending on the current (server) state - which is <code>false</code> by default.</li>
<li>3 methods to enable, disable, and switch (enable =&gt; disable and vice versa) the server part.</li>
</ul>
</li>
</ul>
<p>This class is thread-safe (when compiled on client, no need to handle threads when compiled on server).</p>
<p>There is also different macros defined to avoid writing <code><a class="el" href="classrtype_1_1ModeManager.html" title="Manages the program mode (server, client, client with server). It allows to get the current state of ...">rtype::ModeManager</a>::&lt;method&gt;</code>:</p><ul>
<li><code><a class="el" href="ModeManager_8hpp.html#aad30842d51467778a345724a30fe9349" title="Macro to enable the server.">ENABLE_SERVER()</a></code>, to enable the server.</li>
<li><code><a class="el" href="ModeManager_8hpp.html#a188c5bbe59ad0917401702249fea0f76" title="Macro to disable the server.">DISABLE_SERVER()</a></code>, to disable the server.</li>
<li><code><a class="el" href="ModeManager_8hpp.html#a0a26447dba0121f4991f1774e30cba60" title="Macro to switch the state of the server.">SWITCH_SERVER()</a></code>, to switch the current state of the server.</li>
<li><code>IS_SERVER</code>, to know the current state of the server.</li>
</ul>
<p>To write code thaht will be executed only when the server is active, you can do this: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ModeManager_8hpp.html">RType/ModeManager/ModeManager.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> foo() {</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_define" href="ModeManager_8hpp.html#a019d8e42d712a3d55f2b3611b1787c87">IS_SERVER</a>) {</div>
<div class="line">        <span class="comment">// Server-only code</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aModeManager_8hpp_html"><div class="ttname"><a href="ModeManager_8hpp.html">ModeManager.hpp</a></div></div>
<div class="ttc" id="aModeManager_8hpp_html_a019d8e42d712a3d55f2b3611b1787c87"><div class="ttname"><a href="ModeManager_8hpp.html#a019d8e42d712a3d55f2b3611b1787c87">IS_SERVER</a></div><div class="ttdeci">#define IS_SERVER</div><div class="ttdoc">Macro to get the current state of the server.</div><div class="ttdef"><b>Definition</b> ModeManager.hpp:119</div></div>
</div><!-- fragment --><p> It is also possible to use preprocessor directives with the <code>RTYPE_IS_SERVER</code> macro - as the client -, but the code contained in it will not at all be available for the client when it enables the server. It must be used so a minimum, and only when code should really only be run with <code>r-type_server</code>.</p>
<dl class="section note"><dt>Note</dt><dd>There isn't equivalent implementation for the client, because its state must not change (always enabled on <code>r-type_server</code> and always enabled on <code>r-type_client</code>), and it's useless to have client code on <code>r-type_server</code>. Using preprocessor directives ensure so the code is only compiled and executed on <code>r-type_client</code>.</dd></dl>
<dl class="section remark"><dt>Remarks</dt><dd>To view its code implementation, you can check it <a href="https://github.com/Z4RM/Epitech-Tek3-CPP-R-Type/tree/main/src/RType/ModeManager">here</a>. </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.1 </li>
  </ul>
</div>
</body>
</html>
